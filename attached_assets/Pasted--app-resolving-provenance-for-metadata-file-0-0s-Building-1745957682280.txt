 => [app] resolving provenance for metadata file                                  0.0s
[+] Building 1/1
 âœ” app  Built                                                                     0.0s
ðŸš€ Starting the application...
[+] Running 3/3
 âœ” Network obview_network  Created                                                0.1s
 âœ” Container obview_db     Healthy                                                5.8s
 âœ” Container obview_app    Started                                                5.9s

==========================================
âœ… Fix completed!
The application should now be running.

If you're still having issues, try:
1. docker compose logs -f
2. Running 'docker compose build --no-cache' for a clean build
==========================================
obtv-admin@obview-tbn:/opt/obview$ sudo docker compose logs -f
obview_db   |
obview_db   | PostgreSQL Database directory appears to contain a database; Skipping initialization
obview_app  | Checking environment configuration...
obview_db   |
obview_db   | 2025-04-29 20:13:28.936 UTC [1] LOG:  starting PostgreSQL 16.8 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
obview_db   | 2025-04-29 20:13:28.936 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
obview_db   | 2025-04-29 20:13:28.936 UTC [1] LOG:  listening on IPv6 address "::", port 5432
obview_db   | 2025-04-29 20:13:28.939 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
obview_db   | 2025-04-29 20:13:28.943 UTC [29] LOG:  database system was shut down at 2025-04-29 20:11:58 UTC
obview_db   | 2025-04-29 20:13:28.950 UTC [1] LOG:  database system is ready to accept connections
obview_app  | Waiting for database to be ready...
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:13:34.815Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | npm warn exec The following package was not found and will be installed: drizzle-kit@0.31.0
obview_app  | npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is
obview_app  | npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app  | Checking environment configuration...
obview_app  | Waiting for database to be ready...
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:13:43.894Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app  | Checking environment configuration...
obview_app  | Waiting for database to be ready...
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:13:47.683Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app exited with code 1
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:13:51.625Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app exited with code 1
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:13:55.901Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app exited with code 1
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:14:00.972Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app exited with code 1
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:14:07.702Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app exited with code 1
obview_app  | Waiting for PostgreSQL to become available on db:5432...
obview_app  | Database: obview, User: postgres
obview_app  | SUCCESS: PostgreSQL is up and running
obview_app  | Connection to db:5432 as postgres to database obview was successful
obview_app  | Verifying database connection...
obview_app  | Database connection successful: { now: 2025-04-29T20:14:17.550Z }
obview_app  | Running database migrations...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | WARNING: Database migration script failed. This could be due to missing /app/drizzle directory.
obview_app  | Attempting to generate migration files...
obview_app  | Generating migration files with Drizzle Kit...
obview_app  | This command is deprecated, please use updated 'generate' command (see https://orm.drizzle.team/kit-docs/upgrade-21#how-to-migrate-to-0210)
obview_app  | Retrying database migration...
obview_app  | node:internal/modules/cjs/loader:1215
obview_app  |   throw err;
obview_app  |   ^
obview_app  |
obview_app  | Error: Cannot find module '/app/dist/server/db-migrate.js'
obview_app  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1212:15)
obview_app  |     at Module._load (node:internal/modules/cjs/loader:1043:27)
obview_app  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
obview_app  |     at node:internal/main/run_main_module:28:49 {
obview_app  |   code: 'MODULE_NOT_FOUND',
obview_app  |   requireStack: []
obview_app  | }
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Database migration failed after retry.
obview_app  | You may need to manually run migrations or check database structure.
obview_app  | Setting up admin user if needed...
obview_app  | file:///app/scripts/setup.js:2
obview_app  | const { Pool } = require('@neondatabase/serverless');
obview_app  |                  ^
obview_app  |
obview_app  | ReferenceError: require is not defined in ES module scope, you can use import instead
obview_app  | This file is being treated as an ES module because it has a '.js' file extension and '/app/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
obview_app  |     at file:///app/scripts/setup.js:2:18
obview_app  |     at ModuleJob.run (node:internal/modules/esm/module_job:263:25)
obview_app  |     at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)
obview_app  |     at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)
obview_app  |
obview_app  | Node.js v20.19.1
obview_app  | ERROR: Admin user setup failed
obview_app exited with code 1